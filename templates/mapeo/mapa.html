{% extends "mapeo/base.html" %}

{% block extra_js %}
<link rel="stylesheet" href="/static/general/css/timeline.css" media="screen" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="/static/monitoreo/js/markerclusterer.js"></script>
<script type="text/javascript" src="/static/monitoreo/js/infobox.js"></script>
<script type="text/javascript" src="/static/general/js/custom.js"></script>
<script type="text/javascript" src="/static/general/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/static/general/js/jquery.timelinr-0.9.54.js"></script>

<script type="text/javascript">

$(function(){
    $().timelinr({
        arrowKeys: 'true'
    })
});

$('a[href="#profile"]').on('shown.bs.tab', function(e) {
    {% if centinela == 0 %}
        var tipo_persona = $("#id_tipo_persona").val();
    {% else%}
        var tipo_persona = {{request.session.tipo_persona}};
    {% endif %}

    var map;
    var markers = [];
    $(document).ready(function () {
        var infowindow = new google.maps.InfoWindow();
        var myLatlng = new google.maps.LatLng(13,-85);
        var myOptions = {
            zoom: 7,
            mapTypeControl: true,
            scaleControl: false,
            scrollwheel: false,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var iconBase = '/static/general/img/chinches/';
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            $.post("{% url 'obtener-mapa' el_proyecto.id %}",{tipo_persona:tipo_persona}, function(data){
                $.each(data, function(i, elemento){
                    var latlng = new google.maps.LatLng(elemento.lat, elemento.lon);
                    var marker = new google.maps.Marker({
                        position: latlng,
                        map: map,
                        title: elemento.nombre,
                        icon: iconBase + elemento.tipo + ".png",
                        id: elemento.id
                    });
                    markers.push(marker);
                });
                var markerCluster = new MarkerClusterer(map, markers);
            });


        //$("#map_canvas").css("width", 400).css("height", 400);

    });

            });
</script>
{% endblock extra_js %}

{% block contenido %}
<style>
    .mapa{
    	margin: 0 auto;
    	float: left;
    	width: 708px;
    }
    .mapa #map_canvas {
        height: 500px;
        width: 700px;
        margin: 0 auto;
    }
    #map_canvas img,.google-maps img{max-width:none;}
</style>

<div class="row">
    <h4>{{el_proyecto.nombre}}</h4>
    <div>

      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Proyecto Descripción</a></li>
        <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Actores(mapa)</a></li>
        <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Linea de tiempo</a></li>
        <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Publicaciones</a></li>
      </ul>

      <!-- Tab panes -->
      <div class="tab-content">
        <div role="tabpanel" class="tab-pane fade in active" id="home">
            <ul>
                <li>Inicio: {{el_proyecto.inicio}}</li>
                <li>Finalización: {{el_proyecto.fin}}</li>
                <li>Estado: Activo</li>
                <li>Tipo proyecto: {{el_proyecto.tipo}}</li>
                <li>Administrador del proyecto: {{el_proyecto.encargado}}</li>
            </ul>
            <p>{{el_proyecto.descripcion}}</p>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="profile">
            <form action="." method="POST">
                {% csrf_token %}
                {{form_mapa}}
                <input class="btn btn-default" type="submit" value="Consultar" />
            </form>

            <br>
            <div class="mapa">
                <div id="map_canvas"></div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="messages">
           <div id="timeline">
            <ul id="dates">
             {% for obj in el_proyecto.timelineproyecto_set.all %}
                <li><a href="#{{obj.fecha|date:'d-b-Y'}}">{{obj.fecha|date:"b,Y"}}</a></li>
             {% endfor %}

            </ul>
            <ul id="issues">
            {% for obj in el_proyecto.timelineproyecto_set.all %}
                 <li id="{{obj.fecha|date:'d-b-Y'}}">
                    <h1>{{obj.fecha}}</h1>
                    <p>{{obj.texto}}</p>
                </li>
            {% endfor %}
            </ul>
            <div id="grad_left"></div>
            <div id="grad_right"></div>
            <a href="#" id="next">+</a>
            <a href="#" id="prev">-</a>
        </div>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="settings">
            <ul>
                {% for obj in el_proyecto.biblioteca_set.all %}
                    <li><a href="#">{{obj.titulo}} - tipo: {{obj.get_tipo_display}}</a></li>
                {% endfor %}

            </ul>
        </div>
      </div>

</div>


</div>

{% endblock contenido %}
