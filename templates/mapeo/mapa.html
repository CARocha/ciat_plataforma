{% extends "mapeo/base.html" %}

{% block extra_js %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="/static/monitoreo/js/markerclusterer.js"></script>
<script type="text/javascript" src="/static/monitoreo/js/infobox.js"></script>
<script type="text/javascript" src="/static/general/js/custom.js"></script>
<script type="text/javascript" src="/static/general/js/jquery.cookie.js"></script>
<script type="text/javascript">
    {% if centinela == 0 %}
        var tipo_persona = $("#id_tipo_persona").val();
    {% else%}
        var tipo_persona = {{request.session.tipo_persona}};
    {% endif %}
    console.log(tipo_persona);
    var map;
    var markers = [];
    $(document).ready(function () {
        var infowindow = new google.maps.InfoWindow();
        var myLatlng = new google.maps.LatLng(13,-85);
        var myOptions = {
            zoom: 7,
            mapTypeControl: true,
            scaleControl: false,
            scrollwheel: false,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var iconBase = '/static/general/img/chinches/';
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            $.post("{% url 'obtener-mapa' el_proyecto.id %}",{tipo_persona:tipo_persona}, function(data){
                $.each(data, function(i, elemento){
                    var latlng = new google.maps.LatLng(elemento.lat, elemento.lon);
                    var marker = new google.maps.Marker({
                        position: latlng,
                        map: map,
                        title: elemento.nombre,
                        icon: iconBase + elemento.tipo + ".png",
                        id: elemento.id
                    });
                    markers.push(marker);
                });
                var markerCluster = new MarkerClusterer(map, markers);
            });

    });

</script>
{% endblock extra_js %}

{% block contenido %}
<style>
    .mapa{
    	margin: 0 auto;
    	float: left;
    	width: 708px;
    }
    .mapa #map_canvas {
        height: 500px;
        width: 700px;
        margin: 0 auto;
    }
    #map_canvas img,.google-maps img{max-width:none;}
</style>

<div class="row">
    <h4>{{el_proyecto.nombre}}</h4>
    <form action="." method="POST">
    {% csrf_token %}
    {{form_mapa}}
    <input class="btn btn-default" type="submit" value="Consultar" />
</form>
</div>

<br>
<div class="row mapa">
	<div id="map_canvas"></div>
</div>

{% endblock contenido %}
